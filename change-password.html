<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Forgot Password</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif; }
    body {
      display:flex; justify-content:center; align-items:center;
      height:100vh;
      background:linear-gradient(135deg,#6a11cb,#2575fc);
    }
    form {
      background:#fff; padding:40px 35px; border-radius:20px;
      box-shadow:0 10px 25px rgba(0,0,0,0.15);
      width:380px; text-align:center;
      animation:fadeIn 0.8s ease-in-out;
    }
    h2 { font-size:26px; font-weight:600; margin-bottom:20px; color:#333; }
    input {
      width:100%; padding:14px 16px; margin:10px 0;
      border-radius:10px; border:1px solid #ccc; background:#f9f9f9;
      font-size:15px; transition:0.3s;
    }
    input:focus {
      border-color:#6a11cb; background:#fff;
      box-shadow:0 0 6px rgba(106,17,203,0.3); outline:none;
    }
    button {
      width:100%; padding:14px; margin-top:12px; border:none;
      border-radius:10px; font-size:16px; font-weight:500;
      cursor:pointer; transition:0.3s;
    }
    #sendOtpBtn {
      background:linear-gradient(135deg,#ff6a00,#ee0979); color:#fff;
    }
    #sendOtpBtn:hover:not(:disabled) { opacity:0.9; transform:translateY(-2px); }
    button[type="submit"] {
      background:linear-gradient(135deg,#6a11cb,#2575fc); color:#fff;
    }
    button[type="submit"]:hover:not(:disabled) { opacity:0.9; transform:translateY(-2px); }
    button:disabled { background:#aaa; cursor:not-allowed; opacity:0.7; }
    .hidden { display:none; }
    @keyframes fadeIn {
      from { opacity:0; transform:translateY(20px); }
      to { opacity:1; transform:translateY(0); }
    }
  </style>
</head>
<body>
  <form id="passwordForm">
    <h2>Forgot Password</h2>
    <input type="email" id="email" placeholder="Enter your Email" required />
    <button type="button" id="sendOtpBtn" class="hidden" onclick="sendOtp()">Send OTP</button>

    <div id="otpSection" class="hidden">
      <input type="text" id="otp" placeholder="Enter OTP" required />
      <input type="password" id="newPassword" placeholder="New Password" required />
      <input type="password" id="confirmPassword" placeholder="Confirm Password" required />
      <button type="submit">Update Password</button>
    </div>
  </form>

  <script>
    let generatedOtp = "";

    // Show "Send OTP" button only after email looks valid
    document.getElementById("email").addEventListener("input", function() {
      const emailInput = this.value.trim();
      const sendBtn = document.getElementById("sendOtpBtn");
      if (emailInput.length > 5 && emailInput.includes("@")) {
        sendBtn.classList.remove("hidden");
      } else {
        sendBtn.classList.add("hidden");
      }
    });

    function sendOtp() {
      const email = document.getElementById("email").value.trim();
      let users = JSON.parse(localStorage.getItem("users")) || [];
      const user = users.find(u => u.email === email);

      if (!user) {
        alert("Email not found!");
        return;
      }

      generatedOtp = Math.floor(100000 + Math.random() * 900000).toString();
      alert("Your OTP is: " + generatedOtp); // simulate sending OTP

      document.getElementById("otpSection").classList.remove("hidden");
      const sendBtn = document.getElementById("sendOtpBtn");
      sendBtn.innerText = "OTP Sent";
      sendBtn.disabled = true;
    }

    document.getElementById("passwordForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const enteredOtp = document.getElementById("otp").value.trim();
      const newPassword = document.getElementById("newPassword").value;
      const confirmPassword = document.getElementById("confirmPassword").value;
      const email = document.getElementById("email").value.trim();

      let users = JSON.parse(localStorage.getItem("users")) || [];
      const userIndex = users.findIndex(u => u.email === email);

      if (enteredOtp !== generatedOtp) {
        alert("Invalid OTP!");
        return;
      }
      if (newPassword !== confirmPassword) {
        alert("Passwords do not match!");
        return;
      }
      if (userIndex === -1) {
        alert("User not found!");
        return;
      }

      users[userIndex].password = newPassword; // update password
      localStorage.setItem("users", JSON.stringify(users));

      alert("Password changed successfully!");
      window.location.href = "signIn.html"; // back to login
    });
  </script>
</body>
</html>
